<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>EIL Unified Client Agent: Development Overview</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="intel_logo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">EIL Unified Client Agent
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="header">
  <div class="headertitle">
<div class="title">Development Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#phil">Design Philosophy</a></li>
<li><a href="#pattern">Design Patterns</a><ul>
<li><a href="#statemachine">Client agent state machine</a></li>
<li><a href="#atoms">Atoms</a></li>
<li><a href="#stewdisp">CCMS Update Steward and Dispatcher</a></li>
</ul>
</li>
<li><a href="#devmisc">Miscellany</a><ul>
<li><a href="#platid">PlatformID</a></li>
<li><a href="#utils">Utilities</a></li>
</ul>
</li>
</ul>
<p>Documentation authors: <em>Sam Hart</em> <hr/>
<h2><a class="anchor" id="phil"></a>
Design Philosophy                                               </h2>
<p>The major cross-platform design philosophy utilized in the Unified client agent is separation of platform-specific code from platform-agnostic code. When it's at all possible, code that is specific to a given platform should be isolated from more general code that runs on multiple platforms. A great example of where this philosophy can be seen is in the <a class="el" href="classclientagent_1_1steward_1_1asset_1_1EILAsset.html">EILAsset</a> class and the two, platform- specific classes derived from it.</p>
<p>The <a class="el" href="classclientagent_1_1steward_1_1asset_1_1EILAsset.html">EILAsset</a> class defines base, platform agnostic code which describes the asset data structure and methods for interfacing with CCMS. However, it does not define any logic for collecting asset information and populating the asset data structure as that logic would be highly platform-specific. Instead, it defines two abstract methods, <a class="el" href="classclientagent_1_1steward_1_1asset_1_1EILAsset.html#a470636f9949711f95ef466f6ac589500">EILAsset.initialize</a> and <a class="el" href="classclientagent_1_1steward_1_1asset_1_1EILAsset.html#a0721b284f941e5562200af209c86af70">EILAsset.updateAsset</a>, which should be overridden with the platform-specific logic for asset collection.</p>
<p>Meanwhile, the derived classes <a class="el" href="classclientagent_1_1steward_1_1linux__asset_1_1Linux__Asset.html">Linux_Asset</a> and <a class="el" href="classclientagent_1_1steward_1_1win32__asset_1_1Win32__Asset.html">Win32_Asset</a> derive from <a class="el" href="classclientagent_1_1steward_1_1asset_1_1EILAsset.html">EILAsset</a> and override the initialize and updateAsset methods with logic specific to Linux and Windows respectively.</p>
<p>By abstracting out the agnostic logic from platform-specific logic, we hope that we will both produce cleaner code as well as reduce code duplication.</p>
<h2><a class="anchor" id="pattern"></a>
Design Patterns                                                 </h2>
<p>This section describes various design patterns we've used in the Unified agent codebase.</p>
<h3><a class="anchor" id="statemachine"></a>
Client agent state machine</h3>
<p>The client agent state machine, <a class="el" href="classclientagent_1_1ClientAgentState.html">ClientAgentState</a>, is where anything that must be available for random sub-systems of the client agent should go. In many regards, it can be thought of as a global state machine for the client agent. It is intended to be a static class and treated as if it were singleton, however it is not a real singleton.</p>
<p>ClientAgentState should be treated as read-only. Those properties defined which will be of most use are as follows:</p>
<ul>
<li>CLIENTAGENT_ROOT<ul>
<li>The root directory for the client agent's installation.</li>
</ul>
</li>
<li>CONFIG<ul>
<li>The configuration instance for the client agent. If you are expanding the client agent's features through the use of an [atom](#atoms}, please do not use your own configuration system. Instead, add a sub-section to the client agent's configuration instance and use it. This way all of the client agent's settings can be found in the same place.</li>
</ul>
</li>
<li>SRV_NAME, SRV_DISPLAY_NAME, SRV_DESCRIPTION<ul>
<li>These are strings used primarily in the Windows Service definitions. However, since they may be used elsewhere in the future, they are defined in the ClientAgentState.</li>
</ul>
</li>
<li>VERSION<ul>
<li>The current unified client agent version string.</li>
</ul>
</li>
<li>COMDIR, BINDIR<ul>
<li>These are largely used for compatibility under Linux for the dispatcher scripts. They define the commands directory as well as the binary directory for the client agent. They currently have no meaning under Windows, however they are kept in the ClientAgentState for future use.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="atoms"></a>
Atoms</h3>
<p>In the previous Linux client agent we had a tight, central loop which managed the processing of the agent's commands. The downside to this design was that expanding it or adding new features was difficult and required reworking the central loop. In the Windows client, we had multiple processes for handling basic interactions with CCMS. For the Unified agent, we tried to avoid these problems by using entities we call "atoms".</p>
<p>An "atom" is an object which defines some activity in the client agent which we desire to execute atomically. Example activities include interacting with CCMS to obtain commands, submitting asset information, and communicating with the NMSA. The client agent holds the atoms in a queue and every loop executes those atoms which are still active/alive. Using this atom model, we can define an arbitrary number of activities for the client agent to manage.</p>
<blockquote class="doxtable">
<p>It should be noted that the client agent does not ensure atomicity in the atoms defined in its queue. Instead, it assumes the atom's developer is properly executing and setting atomic flags as necessary. The client agent will simply treat each atom as if it is atomic. The actual atomicity is an implimentation detail.</p>
<p></p>
</blockquote>
<p>Each atom is derived from the atom base class, <a class="el" href="classclientagent_1_1steward_1_1atom_1_1Atom.html">Atom</a>. This base class defines a specific way to interface with atoms in the system. These interfaces are as follows:</p>
<ul>
<li><a class="el" href="classclientagent_1_1steward_1_1atom_1_1Atom.html#ad6414fc42da5319097f62d3185e1d6cd">Atom.ACTIVE</a><ul>
<li>The ACTIVE flag determines whether or not the atom is active. As the client agent runs, it is constantly checking the ACTIVE flag for each atom in its queue. If no atoms are active, that tells the client agent it is time to exit.</li>
</ul>
</li>
<li><a class="el" href="classclientagent_1_1steward_1_1atom_1_1Atom.html#a1c3f624b148df5e2577b23f374a16f0e">Atom.__init__()</a><ul>
<li>The constructor for the atom. This is, obviously, called at process start up. It is safe to assume that the various client agent properties have been set in <a class="el" href="classclientagent_1_1ClientAgentState.html">ClientAgentState</a>.</li>
</ul>
</li>
<li><a class="el" href="classclientagent_1_1steward_1_1atom_1_1Atom.html#a4494a9cb38381254d95849e3624acf36">Atom.shutdown()</a><ul>
<li>This method is called when the client agent is shutting down. It will not be called when the atom is set inactive. Note that you cannot assume your shutdown method will always be called due to the various ways in which the system running the client agent can be restarted or halted. The shutdown method should be considered a "best case scenario" type of operation.</li>
</ul>
</li>
<li><a class="el" href="classclientagent_1_1steward_1_1atom_1_1Atom.html#ac845c419d2efd87f494d126a8e16aef3">Atom.update(timeDelta)</a><ul>
<li>This method is called every loop and should be the entry point for your atom's activities. It is here where the majority of your atom's logic should go. The update method will try to be called once every 30 seconds, although this is not guaranteed. The timeDelta parameter gives the true time elapsed since last update was called.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="stewdisp"></a>
CCMS Update Steward and Dispatcher</h3>
<p>The CCMS update operation, which is arguably the most significant feature of the client agent, is split between two major code-blocks:</p>
<ul>
<li>Steward:<ul>
<li>The steward defines the basic interactions with CCMS. Its logic can be found in the <a class="el" href="classclientagent_1_1steward_1_1ccmsupdate_1_1CCMS__Update.html">CCMS_Update</a> class. The steward should be as platform-agnostic as possible.</li>
</ul>
</li>
<li>Dispatcher:<ul>
<li>The dispatcher handles the platform-specific command executions when the steward receives commands from CCMS. The abstract dispatcher interfaces can be found in the <a class="el" href="classclientagent_1_1dispatcher_1_1Dispatcher.html">Dispatcher</a> class, but some additional, platform-specific code can be found in <a class="el" href="namespaceclientagent_1_1dispatcher__helper.html">dispatcher_helper</a> and in <a class="el" href="namespaceclientagent_1_1steward_1_1commandhandler.html">commandhandler</a>.</li>
</ul>
</li>
</ul>
<blockquote class="doxtable">
<p>The steward/dispatcher distinction is partially legacy from the Linux client agent and partially required for full Linux support. <br/>
<br/>
 Linux is an inhomogeneous platform, and we aim to support a very wide-range of Linux distributions. Thus, operations that might be simple under a more homogeneous platform like Windows can become much more bifurcated under Linux. <br/>
<br/>
 To accomodate this, the Linux-agnostic operations were split out into the steward and the Linux-specific operations were handled by a series of shell scripts known as the dispatcher. This is how the previous Linux client agent worked. <br/>
<br/>
 Today, the unified agent re-uses all of the Linux client agent dispatcher shell scripts for handling commands passed down from CCMS in much the same way they were used previously, however since the agent is unified some dispatcher logic can be found inside the above files for both Windows and Linux. <br/>
<br/>
 Basically, anything that can be easily handled in the unifed agent's Python code-base should, but anything that reflects the bifurcated nature detailed previously will be offloaded to the Linux dispatcher scripts.</p>
<p></p>
</blockquote>
<h2><a class="anchor" id="devmisc"></a>
Miscellany                                                  </h2>
<h3><a class="anchor" id="platid"></a>
PlatformID</h3>
<p>The <a class="el" href="classclientagent_1_1common_1_1platform__id_1_1PlatformID.html">PlatformID</a> class is a Pythonic-singleton (see <a href="http://code.activestate.com/recipes/66531/">Borg State</a> ). It defines platform identification data for whatever operating system platform the unified agent is running on (or, at least it tries to). Currently it defines two flags, and then optional variant identification data as needed.</p>
<ul>
<li><a class="el" href="classclientagent_1_1common_1_1platform__id_1_1PlatformID.html#acbbcea75bac14ea538c7ef6f3a6edb3b">PlatformID.IS_WINDOWS</a><ul>
<li>True if the platform is Windows-based.</li>
</ul>
</li>
<li><a class="el" href="classclientagent_1_1common_1_1platform__id_1_1PlatformID.html#a08c670228e82e83bbcd1592c4241ff77">PlatformID.IS_LINUX</a><ul>
<li>True if the platform is Linux-based.</li>
</ul>
</li>
<li><a class="el" href="classclientagent_1_1common_1_1platform__id_1_1PlatformID.html#a2f707cacffab4d84154922ff61650ea1">PlatformID.VARIANT</a><ul>
<li>This is defined by the class <a href="clientagent.common.platform_id.PlatformID.__PlatformVariant">PlatformID.__PlatformVariant</a>, which is an internal class intended to only be instantiated by PlatformID. The variant information is currently only used under Linux.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="utils"></a>
Utilities</h3>
<p>The following utilities can be found for general usage inside the client agent codebase.</p>
<ul>
<li><a class="el" href="classclientagent_1_1common_1_1ordereddict_1_1OrderedDict.html">OrderedDict</a><ul>
<li>This is an ordered dictionary utilized by the asset collection classes derived from <a class="el" href="classclientagent_1_1steward_1_1asset_1_1EILAsset.html">EILAsset</a>. This exists because native Python dictionaries canot be guaranteed to be unfolded in the same order they were created. This caused formatting problems with web-data generated by the asset information. Thus, the easiest solution was to force an order in our dictionary using this class.</li>
</ul>
</li>
<li><a class="el" href="namespaceclientagent_1_1common_1_1utility.html">utility</a> - This defines a number of utility functions.<ul>
<li><a class="el" href="namespaceclientagent_1_1common_1_1utility.html#a1029b00a2724f1896962dbe7bc9bdf2c">utility.exec_command</a><ul>
<li>Will attempt to execute a command-line command using the parent shell environment regardless of platform. Will return a list containing the output. Note that this is not a useful function when you are looking for exit status codes as it drops this code in favor of output (which is generally logged).</li>
</ul>
</li>
<li><a class="el" href="namespaceclientagent_1_1common_1_1utility.html#a5da20d931b9daf5ec73bf006bc091cf5">utility.getIfInfo</a><ul>
<li>Will attempt to obtain the hardware and IP addresses for the first interface defined by the operating system. Note that you are not guaranteed that what is defined as the first interface in Windows will be the same as the first interface in Linux.</li>
</ul>
</li>
<li><a class="el" href="namespaceclientagent_1_1common_1_1utility.html#a1b73b113aa6c28f095d8bfa83313a951">utility.localExecInPath</a><ul>
<li>Will run through the environmental PATH variable searching for a given application to execute. If it is found, will execute it and return a list containing the output (same as exec_command above). This is used when you need output from a specific external program that you aren't certain is even installed on the system and do not want bogus data in the event that the external program is not found.</li>
</ul>
</li>
<li><a class="el" href="namespaceclientagent_1_1common_1_1utility.html#af121eccde97ce74e56f0875a42eece4c">utility.mkdir_p</a><ul>
<li>Attempts to do the platform equivalent of the Linux command "mkdir -p", which creates a directory and all parent directories as necessary. </li>
</ul>
</li>
</ul>
</li>
</ul>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 23 2012 15:50:30 for EIL Unified Client Agent by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
