<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>EIL Unified Client Agent: EIL Dispatcher API Documentation</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="intel_logo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">EIL Unified Client Agent
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="header">
  <div class="headertitle">
<div class="title">EIL Dispatcher API Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#sh_1">Overview</a><ul>
<li><a href="#sh_1a">Installation location, and importing the libraries</a></li>
</ul>
</li>
<li><a href="#sh_2">The Dispatcher APIs</a><ul>
<li><a href="#sh_2a">"dispatcher.sh"</a></li>
<li><a href="#sh_2b">"globals.sh"</a></li>
<li><a href="#sh_2c">"helper.sh"</a><ul>
<li><a href="#sh_2c1">Platform specification</a></li>
<li><a href="#sh_2c2">Logging functions</a></li>
<li><a href="#sh_2c3">Date functions</a></li>
<li><a href="#sh_2c4">Network functions</a></li>
</ul>
</li>
<li><a href="#sh_2d">"logger.sh"</a></li>
</ul>
</li>
<li><a href="#sh_3">System Toggles</a><ul>
<li><a href="#sh_3a">Locations and meanings of the toggles</a><ul>
<li><a href="#sh_3a1">Toggles in /etc/ca_toggles</a></li>
<li><a href="#sh_3a2">Other toggles</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Documentation author: Sam Hart <hr/>
<h2><a class="anchor" id="sh_1"></a>
Overview                                                    </h2>
<p>The Dispatcher includes shell libraries which can be utilized in external shell scripts. These libraries provide a number of unique features including distribution detection and abstraction,</p>
<h2><a class="anchor" id="sh_1a"></a>
Installation location, and importing the libraries          </h2>
<p>In keeping with the Filesystem Hierarchy Standard (<a href="http://www.pathname.com/fhs/">http://www.pathname.com/fhs/</a>) and LANANA (<a href="http://www.lanana.org/">http://www.lanana.org/</a>), the Dispatcher libraries are installed into </p>
<div class="fragment"><pre class="fragment">    * /opt/intel/eil/clientagent/lib/</pre></div><p> The various libraries contained in this system-wide directory can be included in your shell script in a variety of ways. However, the most platform- agnostic way is to use the dot-execute directive: </p>
<div class="fragment"><pre class="fragment">    DSP_LIB_PATH="/opt/intel/eil/clientagent/lib"
    . ${DSP_LIB_PATH}/helper.sh</pre></div> <h2><a class="anchor" id="sh_2"></a>
The Dispatcher APIs                                         </h2>
<h3><a class="anchor" id="sh_2a"></a>
"dispatcher.sh"</h3>
<p>The "dispatcher.sh" library abstracts the underlying platform for running commands. It requires the "globals.sh" library to be loaded.</p>
<h3><a class="anchor" id="sh_2b"></a>
"globals.sh"</h3>
<p>This library defines a number of global variables utilized by the EIL Dispatcher. Unless you are extending the dispatcher itself, or using some of the internal Dispatcher functionality, you probably will not need to use anything here.</p>
<h3><a class="anchor" id="sh_2c"></a>
"helper.sh"</h3>
<p>This library contains a number of helper features which are utilized by the Dispatcher, but which should be general enough that arbitrary scripts can use it as well.</p>
<h4><a class="anchor" id="sh_2c1"></a>
Platform specification</h4>
<p>By simply sourcing the helper.sh script, you will gain access to information about the underlying Linux distribution. A number of environmental variables will be defined describing the distribution.</p>
<ul>
<li>IS_RHEL</li>
<li>IS_DEB</li>
<li>IS_SLES</li>
<li>IS_ESX</li>
<li>IS_ANGSTROM</li>
</ul>
<p>One of the above will be set to 'yes' (with the others remaining unset) which will define the general distribution flavor.</p>
<p>Beyond the flavor of the distribution, you can additionally check the variable</p>
<ul>
<li>PLATFORM_NAME</li>
</ul>
<p>which will contain a string detailing the more specific dialect of the distribution.</p>
<p>For example, CentOS would be defined as:</p>
<ul>
<li>IS_RHEL=yes</li>
<li>PLATFORM_NAME="centos"</li>
</ul>
<h4><a class="anchor" id="sh_2c2"></a>
Logging functions</h4>
<p>The helper library contains two functions for logging:</p>
<ul>
<li>trace()<ul>
<li>This function will log to the standard client agent log file, which defaults to ${HOME_DIR}/client-agent-base.log .</li>
</ul>
</li>
</ul>
<ul>
<li>trace_error()<ul>
<li>This function will log to the client agent error log file, which defaults to ${HOME_DIR}/client-agent-error.log .</li>
</ul>
</li>
</ul>
<h4><a class="anchor" id="sh_2c3"></a>
Date functions</h4>
<p>The helper library provides a number of functions which assist in high-level date logic.</p>
<ul>
<li>date_utc_stamp()<ul>
<li>This function takes a parameter of a date string (or "now" to indicate the current time) and returns a specially formatted UTC stamp which can be used by the other date functions.</li>
</ul>
</li>
</ul>
<ul>
<li>date_utc_stamp_delta()<ul>
<li>This function takes three parameters. The first parameter is one of: -s : second -m : minute -d : day The next two parameters are UTC date stamps (returned from date_utc_stamp). It will compute and return the delta (in whatever format you request) between the two date stamps.</li>
</ul>
</li>
</ul>
<h4><a class="anchor" id="sh_2c4"></a>
Network functions</h4>
<p>The helper library provides a number of functions which assist with various network items.</p>
<ul>
<li>get_system_ip()<ul>
<li>This function returns the system's IP information. It requires working grep, cut and awk commands.</li>
</ul>
</li>
</ul>
<ul>
<li>is_hosts_setup()<ul>
<li><p class="startli">This function queries the /etc/hosts file to verify whether or not the EIL entries are in place. It returns 0 upon success (meaning the entries are there) or 1 on failure (meaning the entries are not there).</p>
<p class="startli">The main reason this function exists (though it can easily have uses elsewhere) was because of a need on XenClient where the hosts file was being destroyed at odd times after boot causing TCP diagnostic script runs which resulted in Linux client agent hangs.</p>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="sh_2d"></a>
"logger.sh"</h3>
<p>Access to the Linux client agent's logging facilities by external applications can be found through the logger.sh script. This script is located in the tools/ directory under the install directory (typically /opt/intel/eil/clientagent/tools). The usage for this script is as follows: </p>
<div class="fragment"><pre class="fragment">Usage: logger.sh [OPTION] &lt;log message&gt;
Where:
    &lt;log message&gt;   - is your log message
    [OPTION]        - is one of the following

    --std           Log the message to the standard client agent dispatcher log
                    (default when called with no options).

    --err           Log the message to the client agent dispatcher error log.

    --echo          Echo the message back to STDOUT in addition to whatever
                    else it may be doing.

    --nostd         Disable standard client agent dispatcher logging (use in
                    combination with '--echo' if you wish you only log to
                    STDOUT)</pre></div><p> So, if you wanted to log the message "Error during operation FOO" to the client agent's error logs from an external application, you would call the logger.sh script with the following parameters: </p>
<div class="fragment"><pre class="fragment">logger.sh --err Error during operation FOO</pre></div> <h2><a class="anchor" id="sh_3"></a>
System Toggles                                              </h2>
<p>There are several system-wide toggles which affect the behavior of the various components of the client agent. This section defines what they are and what they mean.</p>
<h3><a class="anchor" id="sh_3a"></a>
Locations and meanings of the toggles</h3>
<h4><a class="anchor" id="sh_3a1"></a>
Toggles in /etc/ca_toggles</h4>
<p>Most toggles for the client agent can be found in /etc/ca_toggles. These toggles are as follows:</p>
<ul>
<li>/etc/ca_toggles/no_init This determines that a system should not have the client agent components start at boot. During the installation process, a post- install script will check for this and disable the init scripts.</li>
</ul>
<ul>
<li>/etc/ca_toggles/ac_image This determines that an install is for an asset collection image. When a new system is added to the cloud, the client agent needs to run, collect asset information on the system and then report that information to CCMS. Once this is done, the system should reboot for normal provisioning. This toggle should be set on the asset collection image to trigger this.</li>
</ul>
<h4><a class="anchor" id="sh_3a2"></a>
Other toggles</h4>
<ul>
<li>/opt/intel/eil/clientagent/home/.nmsa_enable This determines whether or not NMSA is to be enabled. This is automatically set during installation, but you can override it by removing or touching this file. </li>
</ul>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 23 2012 15:52:08 for EIL Unified Client Agent by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
