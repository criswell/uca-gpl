<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>EIL Unified Client Agent: Installation Overview</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="intel_logo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">EIL Unified Client Agent
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="header">
  <div class="headertitle">
<div class="title">Installation Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#overview">Understanding the install process</a><ul>
<li><a href="#hilevel">High level overview</a></li>
<li><a href="#maninstall">Manual installation</a></li>
</ul>
</li>
<li><a href="#instdet">The installation process in more detail</a><ul>
<li><a href="#bootstrap">uca-bootstrap.py</a><ul>
<li><a href="#zipfile">uca.zip</a></li>
</ul>
</li>
<li><a href="#installer">uca-installer.py</a></li>
</ul>
</li>
<li><a href="#relbuild">Release building</a><ul>
<li><a href="#relformat">Format of the release directory</a></li>
<li><a href="#relscripts">Scripts to help automate the release process</a><ul>
<li><a href="#relbuildsh">Release builder</a></li>
<li><a href="#releasesh">Release script</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Documentation authors: <em>Sam Hart</em> <hr/>
<h2><a class="anchor" id="overview"></a>
Understanding the install process                                </h2>
<p>The unified client agent needed to have a common way to install on a variety of platforms. The install process needed to not only operate under a variety of Windows flavors, but also under a very wide range of Linux distrubutions. It also needed to install the agent and its utilities in very specific locations. Under Windows, the previous convention of "C:\EIL" as the install root was necessary for compatibility with other EIL tools. Under Linux, we wanted to conform to <a href="http://www.pathname.com/fhs/">LFHS</a>, <a href="http://www.linuxfoundation.org/collaborate/workgroups/lsb/group">LSB</a> and <a href="http://stewbenedict.org/lsb/lanana/">LANANA</a> conventions whenever possible (and whenever it doesn't conflict with previously stated goals). Further, under Linux we previously had LFHS and LSB defined paths which we wanted to keep for compatibility. Additionally, we needed a clear and reliable way not only to uninstall the client agent cross-platform, but also paths for upgrades and re-installs.</p>
<p>Because of these reasons, we could not utilize other standard installation methods for Python applications nor could we utilize platform-specific install solutions such as Py2EXE installers under Windows or package files under Linux. Instead, we had to come up with our own cross-platform installer and upgrader for the unified client agent.</p>
<h3><a class="anchor" id="hilevel"></a>
High level overview</h3>
<p>From a very high level, here's the general install process for the unified agent.</p>
<ul>
<li>A bootstrapper tool first checks for compatibility, then attempts to set up the installation environment. It then downloads a cross-platform package (zip file) from a known location.</li>
<li>Inside the cross-platform package is the unified agent and an installer. The bootstrapper extracts the package and executes the installer.</li>
<li>The installer does the following:<ul>
<li>It performs additional sanity checks on the system and the package.</li>
<li>It shuts down and disables any previous version of the unified agent, or platform-specific agents (Linux client agent or Windows client agent).</li>
<li>It backs up any configuration files from previous installs.</li>
<li>It does a best effort to un-install any previous agents.</li>
<li>It ensures that the correct install tree is set up.</li>
<li>It ensures that the system's hosts file is properly set for the CCMS and NMSA IPs.</li>
<li>It installs the unified agent from the archive.</li>
<li>Any additional platform-specific tools are installed.</li>
<li>The previous configuration files are restored.</li>
<li>The unified agent is started, and the installer cleans up after itself.</li>
</ul>
</li>
</ul>
<p>The bootstrapper/installer combination are intended to be used on supported systems for fresh installs, re-installs, and upgrades.</p>
<h3><a class="anchor" id="maninstall"></a>
Manual installation</h3>
<p>To install the unified agent by hand, simply execute the bootstrap tool as an administrator ("Administrator" under Windows, or "root" under Linux). Download the latest bootstrap from the production IP address, and execute it: </p>
<div class="fragment"><pre class="fragment"># python uca-bootstrap.py</pre></div><p> Refer to the more detailed installation instructions found inside the unified agent's repository in the document: </p>
<div class="fragment"><pre class="fragment">docs/tests/test-document.odt</pre></div> <h2><a class="anchor" id="instdet"></a>
The installation process in more detail                         </h2>
<h3><a class="anchor" id="bootstrap"></a>
"uca-bootstrap.py"</h3>
<p>The bootstrapper, defined in <a class="el" href="namespaceuca-bootstrap.html">uca-bootstrap</a>, performs basic bootstrapping of the installation environment for the unified agent. It is intended to be a very simple script with the bulk of the installation logic contained in a separate installer. The reason for this is that by keeping the bootstrapper simple it will not need to be updated often, which means it can be used to upgrade arbitrary client agent installs to the latest version regardless of how old the install is.</p>
<p>Production and staging IPs are defined for where the unified agent installer can be found in the <a class="el" href="namespaceuca-bootstrap.html#a9d09f6a6ea1d30228b9ab5c1b065e9a2">PRODUCTION_IP</a> and <a class="el" href="namespaceuca-bootstrap.html#aa6c9c60c3509127d0a09c0d60acf9354">STAGING_IP</a> variables set in the bootstrapper. The bootstrapper can be told which to use by toggling the <a class="el" href="namespaceuca-bootstrap.html#a0e92c4a325dd524e3c59101d9eb30f3d">IS_PRODUCTION</a> boolean.</p>
<p>The bootstrapper uses Python's logging framework to log all of its actions to a log file. This log file is stored in the root directory of the filesystem ("C:\" if Windows, or "/" if Linux). It also outputs the log to STDOUT so that anyone manually running it can see the actions. The log file will be moved into the unified agent's root directory after installation is successful.</p>
<p>The bootstrapper goes to the IP address defined above and attempts to download the file "uca.zip" from there. This is a specially formatted zip archive meant to only be consumed by the bootstrap tool.</p>
<blockquote class="doxtable">
<p>NOTE: The bootstrap tool can be pointed to a local copy of the "uca.zip" file by passing the local path to the file as an optional parameter to the script:</p>
<p></p>
</blockquote>
<div class="fragment"><pre class="fragment"># python uca-bootstrap.py /path/to/local/uca.zip</pre></div><p> Once the bootstrapper has downloaded the zip file, it will extract it to a tempoary directory and execute the <a href="#installer">installer</a> contained inside.</p>
<h4><a class="anchor" id="zipfile"></a>
"uca.zip"</h4>
<p>The format of the uca zip file is very specific. It must adhere to the standard set here. The best way to ensure that is to use the "uca-builder" script described below. </p>
<div class="fragment"><pre class="fragment">    .
    |-- bin
    |   |-- TODO
    |   |-- clientagent
    |   |   |-- ....
    |   |   `-- steward
    |   |       |-- ....
    |   |-- eil_steward.py
    |   |-- elevate_script
    |   |-- suds
    |   |   `-- ....
    |   `-- tests
    |       `-- ....
    |-- lib
    |   `-- VERSION
    |-- linux
    |   `-- dispatcher
    |       `-- ...
    |-- tools
    |   |-- uca-bootstrap.py
    |   `-- uca-installer.py
    |-- uca-bootstrap.py
    |-- uca-installer.py
    `-- windows
        `-- ....</pre></div><p> Inside the zip file, at the top level there must be the bootstrap tool as well as the install tool. Undernath the top level you will find the following:</p>
<ul>
<li>bin<ul>
<li>Contains the unified agent Python scripts and all necessary support tools, libraries, and files.</li>
</ul>
</li>
<li>lib<ul>
<li>Currently only contains the VERSION file, however is reserved for additional library tools not directly included with the Python scripts above (e.g., library objects that are not required to be in the Python path).</li>
</ul>
</li>
<li>linux<ul>
<li>Contains the dispatcher and other Linux-specific tools necessary for the unified agent to run under Linux.</li>
</ul>
</li>
<li>windows<ul>
<li>Contains any Windows-specific tools necessary for the unified agent to run under Windows. Currently is empty, but reserved for future use.</li>
</ul>
</li>
<li>tools<ul>
<li>Contains the installer, bootstrapper, and any other tools necessary for the installation and setup of the unified agent.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="installer"></a>
"uca-installer.py"</h3>
<p>The installer should be called with exactly one command-line argument, the full path to the extracted zip file. The installer is not intended to be used by hand, instead it should be executed by the bootstrap tool. The installer is defined in the <a class="el" href="namespaceuca-installer.html">uca-installer</a> package.</p>
<p>Inside the installer are four very specific sections:</p>
<ul>
<li>Windows specific code<ul>
<li>Inside this section are any and all Windows specific functions to be used during the installation. These functions are all named with the prefix "win32_".</li>
</ul>
</li>
<li>Linux specific code<ul>
<li>Inside this section are any and all Linux specific functions to be used during the installation. These functions are all named with the prefix "linux_".</li>
</ul>
</li>
<li>Generic code<ul>
<li>Inside this section are functions which are platform agnostic and can be used on either Linux or Windows. There is no special naming convention here.</li>
<li>Some noteworthy functions include:<ul>
<li><a class="el" href="namespaceuca-installer.html#a7bc490185eb1aefe39473ade262d0b86">uca-installer.precompilePy</a><ul>
<li>This is used to precompile the Python modules for installation. Those modules defined in <a class="el" href="namespaceuca-installer.html#a92a84ce4cd011532c88b614d86e344d0">uca-installer.PRECOMPILE_EXCEPTIONS</a> will be excluded from this process.</li>
</ul>
</li>
<li><a class="el" href="namespaceuca-installer.html#a85473c93932916d0488f7bdc8a8af7b2">uca-installer.copyHome</a><ul>
<li>This attempts to backup the previous installation's configuration and log directory. It is also used to restore the backup (by swapping the parameters).</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Main installation logic<ul>
<li>Finally, at the end of the file, you will find the main installation logic.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="relbuild"></a>
Release building                                                </h2>
<p>In order to make a release (production or staging) you can manually build the release, or you can utilize the release building scripts. Either way, this section will explain how it is done.</p>
<h3><a class="anchor" id="relformat"></a>
Format of the release directory</h3>
<p>The release is intended to be a specially formatted web directory which the bootstrap tool and installer expect. The general format of this is as follows: </p>
<div class="fragment"><pre class="fragment">    -rw-r--r-- 1 root root     13 Apr 20 16:29 VERSION.txt
    -rwxr-xr-x 1 root root   4909 Apr 20 16:29 uca-bootstrap.py
    -rw-r--r-- 1 root root 859645 Apr 20 16:29 uca.zip</pre></div><ul>
<li>"VERSION.txt"<ul>
<li>The version file for this release. This is used as an update checker.</li>
</ul>
</li>
<li>"uca-bootstrap.py"<ul>
<li>The latest bootstrapper. Note that it shouldn't change much, see documentation for the bootstrap tool above.</li>
</ul>
</li>
<li>"uca.zip"<ul>
<li>The latest zip file archive (as defined above).</li>
</ul>
</li>
</ul>
<p>In addition to these, the production release should include the Windows EIL tools, which are described elsewhere and are beyond the scope of this document.</p>
<h3><a class="anchor" id="relscripts"></a>
Scripts to help automate the release process</h3>
<p>There are two scripts currently used to automate the release process. These scripts are BASH shell scripts, which means they must be run under Linux, or under CYGWIN in Windows.</p>
<p>In order to use them, you need to have the release directory mounted locally. For example, if this is a production release and I were working under Linux I might have the following entry in my fstab file: </p>
<div class="fragment"><pre class="fragment">//172.16.3.10/EILuca /mnt/EILuca      smbfs   username=shart2x,password=myPass,uid=sam,gid=sam 0 0</pre></div><p> which would mount the EILuca directory under "/mnt/EILuca".</p>
<h4><a class="anchor" id="relbuildsh"></a>
Release builder</h4>
<p>The release builder, "uca-builder.sh", should be run from within the unified agent's repository. It will take the current version of the agent, create a properly formatted zip file (see "uca.zip" above) and place it in your current working directory.</p>
<p>This script is actually pretty blunt and rough. It is advised you do not use it directly unless you know what you are doing. It is better to use the release script (described below) which wraps this builder.</p>
<h4><a class="anchor" id="releasesh"></a>
Release script</h4>
<p>The release script, "uca-release.sh", is the general release building and deployment tool for the unified agent. It should be used for staging and production releases. Its usage is as follows: </p>
<div class="fragment"><pre class="fragment">Usage: uca-release.sh /path/to/release [branch]

Parameters:
    - /path/to/release should be an absolute path to where the release goes.

    - [branch] is an optional named branch for the Mercurial repository.

This release tool should be ran from within a current, working, Mercurial
repository of the UCA. It will clone the current directory to a temp directory,
and build the release there.

If your release needs to be built from a specific named branch from the
repository, then you can give that branch name with the optional parameter
[branch].</pre></div><p> Thus, if I was making a release using the branch "production" into the directory I had mounted above, I would use "uca-release.sh" this way: </p>
<div class="fragment"><pre class="fragment">$ cd /path/to/my/repository
$ ./uca-release.sh /mnt/EILuca production</pre></div> </div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 23 2012 15:52:08 for EIL Unified Client Agent by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
